@using Microsoft.AspNetCore.Components.Web
@using System.Diagnostics
@using System.Data;
@using ReservationAdmin.Models;

<form>
    <div style="background-color:#D5DAD7; float :left; width: 35%;  height: 100vh;">
        <p style="margin-left: 7%; color: #9597A6; font-size: 24px;padding-top: 5px;    margin-bottom: 5px;">Aanmaken reservering</p>

        <div style="border-top: 1px solid;padding-bottom: 7px;   margin-left: 2%; width: 95%; ">
            <h4>Gegevens</h4>
            <div style="padding: 30px; background-color: #ffffff;">
                <div class="form-inline  form-group">
                    <label for="Name">Volledig naam</label>

                    <input type="text" class="form-controls" @bind="CreateRes.FullName" aria-describedby="FullName" placeholder="Volledige naam" required />

                </div>
                <div class="form-inline form-group ">
                    <label for="Email" style="margin-right:10%;">Email      </label>
                    <input type="email" class="form-controls" @bind="CreateRes.Email" aria-describedby="emailHelp" placeholder="Email adres" required />

                </div>
                <div class="form-inline  form-group">
                    <label for="InputAmount">Aantal personen</label>
                    <input type="number" class="form-control" @bind="CreateRes.Amount" aria-describedby="Amount" placeholder="6" min="1" max="6" required />
                </div>

            </div>

            <div>
                <h4>Dagdeel</h4>
                <div  class="Daypart-div">
                    <div class="Daypart">
                    <button  type="button" @onclick="(e => SelectedDaypart(false))"  class="btn Daypart-btn Daypart-btn-lunch">
                        <h5>Lunch</h5>
                        <p>11:00 - 16:00</p>
                    </button>
                    <button type="button" @onclick="(e=> SelectedDaypart(true))"  class="btn Daypart-btn   Daypart-btn-diner">
                         <h5>Diner</h5>
                         <p>17:00 - 20:00</p>
                    </button>
                    </div>
    

                </div>
            </div>
        </div>


    </div>

    <button type="submit" @onclick="(e => InsertUser())" class=" btn-ResAdmin btn btn-primary">
        Reserveren
    </button>
</form>
<div class="Table-div">

    <h1>Tafel kiezen</h1>
    <div class="Tafel   card-group" style=" background-image: url('images/tafel-van-zes.png');  width:500px; height:450px; margin-left: 69px;
        margin-bottom: 36px; ">

        <div style=" margin-left:21%; margin-top: 7%;">

            <button @onclick="(e => SelectedTable(1))" style="width: 47px;
        height: 57px; margin-left: 10px;   margin-right: 33px; " class="Tafel tafels btn btn-primary">
                1
            </button>

            <button @onclick="(e => SelectedTable(2))" style="width: 47px;
        height: 57px; margin-left: 10px;   margin-right: 33px; " class="Tafel btn btn-primary">
                2
            </button>
            <button @onclick="(e => SelectedTable(3))" style="width: 47px;
        height: 57px; margin-left: 10px;   margin-right: 33px; " class="Tafel btn btn-primary">
                3
            </button>
        </div>

        <div style="margin-top: 7%;">
            <button class="Tafel  btn btn-primary" @onclick="(e => SelectedTable(4))" style="width: 47px; height: 87px; margin-left: 27px; margin-right: 40px; margin-top: 15px;">
                4
            </button>
        </div>

        <div style="padding-left: 50%;height: 7%; margin-top: -3%;">
            <button @onclick="(e => SelectedTable(5))" style="width: 30px; height: 35px; margin-right:48px;" class=" Tafel btn btn-primary">6</button>
            <button @onclick="(e => SelectedTable(6))" style="width: 30px; height: 35px; " class=" Tafel btn btn-primary">5</button>
        </div>

        <div style="width: 27%; margin-left: 1%;margin-bottom: 24%;  margin-top: 3%;">
            <button @onclick="(e => SelectedTable(8))" style="width: 58px;  height: 48px; margin-left: 25px;  margin-right: 33px;  margin-top: 17%;" class=" Tafel btn btn-primary">
                8
            </button>
            <button @onclick="(e => SelectedTable(10))" style="width: 58px;  height: 48px;  margin-left: 25px;  margin-right: 33px;  margin-top: 31%;" class=" Tafel btn btn-primary">
                10
            </button>
            <button @onclick="(e => SelectedTable(11))" style=" width: 90px; height: 48px; margin-left: 25px; margin-right: 33px;   margin-top: 34%;" class="Tafel  btn btn-primary">
                11
            </button>
        </div>
        <div style="  width: 19%; margin-left: 1%; ">
            <button @onclick="(e => SelectedTable(7))" style="width: 58px;height: 46px; margin-left: 7px;margin-right: 6px; margin-top: 20%;" class="Tafel btn btn-primary">
                7
            </button>
            <button @onclick="(e => SelectedTable(9))" style=" width: 59px; height: 45px; margin-left: 7px; margin-right: 33px;  margin-top: 55%;" class="Tafel btn btn-primary">
                9
            </button>
        </div>

    </div>

</div>



@code{


    public int i;
    SqlConnection con = new SqlConnection();
    public string Message;
    Reservation CreateRes = new Reservation();
    void SelectedTable(int SelectedTable)
    {
        CreateRes.Table = SelectedTable;
        Message = "Tafel Nummer gekozen" + CreateRes.Table.ToString();
        Debug.WriteLine(Message);


    }
    void SelectedDaypart(bool SelectedDaypart)
    {
        if (SelectedDaypart == false)
        {
            CreateRes.Daypart = "lunch";
        }
        else
        {
            CreateRes.Daypart = "diner";
        }
        Message = "daypart  gekozen" + CreateRes.Daypart.ToString();
        Debug.WriteLine(Message);


    }

   bool IsValidEmail(string email)
{
    try {
        var addr = new System.Net.Mail.MailAddress(email);
        return addr.Address == email;
    }
    catch {
        return false;
    }
}

    void InsertUser()
    {
 
        CreateRes.date = DateTime.Today;

        IsValidEmail(CreateRes.Email);
        if (IsValidEmail(CreateRes.Email) != false)
        {
            con.SqlQuery("INSERT INTO `guest`(`FullName`, `Email`) VALUES (@Fullname,@Email)");
            con.Cmd.Parameters.AddWithValue("@Fullname", CreateRes.FullName);
            con.Cmd.Parameters.AddWithValue("@Email", CreateRes.Email);
            con.NonQueryEx();
            InsertReservation();
        }
    }

    void InsertReservation()
    {
        con.SqlQuery("SELECT `id_Guest` FROM `guest` WHERE `FullName`=@Fullname AND `Email`=@Email");
        con.Cmd.Parameters.AddWithValue("@Fullname", CreateRes.FullName);
        con.Cmd.Parameters.AddWithValue("@Email", CreateRes.Email);
        con.QueryEx();

        foreach (DataRow dr in con.QueryEx().Rows)
        {
            string id = dr[0].ToString();

            con.SqlQuery("INSERT INTO `reservation`(`Date`, `DayPart`, `TableNumber`, `Guest`, `Amount`) VALUES (@Date,@Daypart,@TableNumber,@Guest,@Amount)");
            con.Cmd.Parameters.AddWithValue("@Date", CreateRes.date);
            con.Cmd.Parameters.AddWithValue("@Daypart", CreateRes.Daypart);
            con.Cmd.Parameters.AddWithValue("@TableNumber", CreateRes.Table);
            con.Cmd.Parameters.AddWithValue("@Guest", id);
            con.Cmd.Parameters.AddWithValue("@Amount", CreateRes.Amount);
            con.NonQueryEx();

        }

    }
}

